(function(e){function t(t){for(var r,o,i=t[0],c=t[1],d=t[2],l=0,u=[];l<i.length;l++)o=i[l],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&u.push(s[o][0]),s[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);p&&p(t);while(u.length)u.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,o=1;o<a.length;o++){var i=a[o];0!==s[i]&&(r=!1)}r&&(n.splice(t--,1),e=c(c.s=a[0]))}return e}var r={},o={app:0},s={app:0},n=[];function i(e){return c.p+"js/"+({help:"help",home:"home"}[e]||e)+".js"}function c(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,c),a.l=!0,a.exports}c.e=function(e){var t=[],a={help:1,home:1};o[e]?t.push(o[e]):0!==o[e]&&a[e]&&t.push(o[e]=new Promise((function(t,a){for(var r="css/"+({help:"help",home:"home"}[e]||e)+".css",s=c.p+r,n=document.getElementsByTagName("link"),i=0;i<n.length;i++){var d=n[i],l=d.getAttribute("data-href")||d.getAttribute("href");if("stylesheet"===d.rel&&(l===r||l===s))return t()}var u=document.getElementsByTagName("style");for(i=0;i<u.length;i++){d=u[i],l=d.getAttribute("data-href");if(l===r||l===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var r=t&&t.target&&t.target.src||s,n=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");n.code="CSS_CHUNK_LOAD_FAILED",n.request=r,delete o[e],p.parentNode.removeChild(p),a(n)},p.href=s;var m=document.getElementsByTagName("head")[0];m.appendChild(p)})).then((function(){o[e]=0})));var r=s[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,a){r=s[e]=[t,a]}));t.push(r[2]=n);var d,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=i(e);var u=new Error;d=function(t){l.onerror=l.onload=null,clearTimeout(p);var a=s[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",u.name="ChunkLoadError",u.type=r,u.request=o,a[1](u)}s[e]=void 0}};var p=setTimeout((function(){d({type:"timeout",target:l})}),12e4);l.onerror=l.onload=d,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,a){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(c.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(a,r,function(t){return e[t]}.bind(null,r));return a},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var d=window["webpackJsonp"]=window["webpackJsonp"]||[],l=d.push.bind(d);d.push=t,d=d.slice();for(var u=0;u<d.length;u++)t(d[u]);var p=l;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"29bb":function(e,t,a){"use strict";function r(e){const t=window.location.port;return 0===t.indexOf("80")?e.replace("5001","8080"):e}a.d(t,"a",(function(){return r}))},4360:function(e,t,a){"use strict";var r=a("a026"),o=a("2f62"),s=a("c151"),n=a("a18c"),i=a("2ef0"),c=a.n(i),d=a("e3c5"),l=a("29bb"),u=a("bc3a"),p=a.n(u);const m=JSON.parse(window.localStorage.getItem("user"))||{},h=p.a.create({headers:{Authorization:"Bearer "+m.token}});let b;const g={widgets:[],boards:null,board:null,tags:[]},f={async initApp(e){return await e.dispatch("fetchBoards"),!0},async fetchTags(e){try{const t=await s["a"].fetchTags();let a=Object.entries(t).map(e=>Object.assign(e[1],{label:e[0]}));a=a.map(e=>Object.assign(e,{value:"all"===e.label?"":e.label})),e.commit("setTags",a)}catch(t){}},async clearWidgets(e){},async fetchBoards(e,t={type:"full"}){window.clearTimeout(b);const a=await s["a"].fetchBoards();return e.commit("setBoards",a.boards),"full"===t.type&&(b=window.setTimeout((function(){e.dispatch("setActiveBoard",a.board)}),25)),a.boards},async sortBoard(e,{oldIndex:t,newIndex:a,newSort:r}){let o=e.state.boards.find(t=>t.name===e.state.board);o=c.a.cloneDeep(o);const n=r.map(e=>o.widgets.find(t=>t.rsc_id===e));o.widgets=n,e.commit("setBoard",o),e.commit("setWidgets",n),n.filter(e=>e.custom_card).forEach(t=>{e.dispatch("fetchWidget",{endpoint:Object(l["a"])(t.endpoint[0]),id:t.rsc_id,accept:"application/json"})});try{await s["a"].updateBoard({boards:e.state.boards})}catch(i){console.error(i)}},async removeFromBoard(e,t){e.commit("removeFromBoard",t);try{await s["a"].updateBoard({boards:e.state.boards})}catch(a){console.error(console.error)}},async setActiveBoard(e,t){return e.commit("setActiveBoard",t),e.dispatch("fetchWidgets"),n["a"].history.current.params.board!==t&&n["a"].push({name:"Home",params:{board:t}}),await s["a"].persistOptions({board:t}),!0},async fetchWidgets(e){const t=e.state.boards.find(t=>t.name===e.state.board);try{const a=c.a.cloneDeep(t.widgets).map(e=>(e.icon=e.icon||"mdi-copyright",e.description=e.description||"",e.custom_card=e.custom_card||!1,e.res=null,e.error=null,e));e.commit("setWidgets",a),t.widgets.forEach(t=>{const a="string"===typeof t?t:t.rsc_id;e.dispatch("fetchWidget",{endpoint:Object(l["a"])(t.endpoint[0]),id:a,accept:"application/json"})})}catch(a){r["default"].prototype.raiseError(new Error("Board not found."))}},async fetchWidget(e,t={id:-1,accept:"application/json",endpoint:""}){let a;const{id:r,accept:o,endpoint:s}=t;try{a=await h.get(`${s}/_info/card/${r}`,{headers:{common:{Accept:o}}}),a=a.data,e.commit("preAddWidget",a)}catch(n){e.commit("preAddWidget",{rsc_id:r,error:n})}return a},async fixWidget(e,t){const a={search:t.title,tags:[],page:0,per_page:1};try{const n=await s["a"].searchWidgets(a);if(n.data.length>0){const a=n.data[0],i=t;e.commit("addToBoard",[a]),e.commit("removeFromBoard",i.rsc_id),await e.dispatch("fetchWidget",{id:a.rsc_id,accept:"application/json",endpoint:Object(l["a"])(a.endpoint[0])});try{await s["a"].updateBoard({boards:e.state.boards})}catch(o){r["default"].prototype.raiseError(o)}return!0}window.alert("Not possible to fix the broken widget.")}catch(o){console.log(o)}return!1},async createBoard({commit:e},t){const a=g.boards.find(e=>e.name===t.board);let r=c.a.cloneDeep(g.boards)||[];if(null!=a)throw new Error("Board exists");{const a={name:t.board,widgets:[]};r=r.concat([a]),await s["a"].createBoard(r),e("setBoards",r)}return r},async deleteBoard(e,t){let a=c.a.cloneDeep(g.boards)||[];a=a.filter(e=>e.name!==t);try{if(await s["a"].updateBoard({boards:a}),e.commit("setBoards",a),e.state.board===t){const t=(a[0]||{}).name;e.dispatch("setActiveBoard",(a[0]||{}).name),n["a"].history.current.params.board!==t&&n["a"].push({name:"Home",params:{board:t}})}return!0}catch(o){r["default"].prototype.raiseError(o)}},async editBoard(e,t){const a=g.boards.find(e=>e.name===t.board);if(null!=a)throw new Error("Board exists");try{let a=c.a.cloneDeep(g.boards)||[];return a=a.map(e=>(e.name===t.oldName&&(e.name=t.board),e)),e.commit("setBoards",a),await s["a"].createBoard(a),e.state.board===t.oldName&&(e.commit("setActiveBoard",t.board),await s["a"].persistOptions({board:t.board}),n["a"].history.current.params.board!==t.board&&n["a"].push({name:"Home",params:{board:t.board}})),!0}catch(o){return r["default"].prototype.raiseError(o),!1}},async updateBoard(e,t){const a=c.a.cloneDeep(e.getters.boardWithWidgets),o=[];let n=0;t.forEach(t=>{const r=a.widgets.find(e=>e.rsc_id===t.rsc_id);r?(a.widgets=a.widgets.filter(e=>e.rsc_id!==t.rsc_id),e.commit("removeFromBoard",t.rsc_id),n++):(a.widgets.push(t),o.push(t))}),e.commit("addToBoard",o);try{await s["a"].updateBoard({boards:e.state.boards})}catch(u){r["default"].prototype.raiseError(u)}o.forEach(t=>{e.dispatch("fetchWidget",{id:t.rsc_id,accept:"application/json",endpoint:Object(l["a"])(t.endpoint[0])})});let i="Board updated. ";return o.length&&(i+=`${o.length} widget${o.length>1?"s":""} added. `),n>0&&(i+=`${n} widget${n>1?"s":""} removed.`),d["a"].$emit("SHOW_NOTIFICATION",{type:"success",text:i}),!0}},v={setBoard(e,t){e.boards=e.boards.map(e=>e.name===(t||{}).name?t:e)},setTags(e,t){e.tags=t},preAddWidget(e,t){const a=null!=e.widgets.find(e=>e.rsc_id===t.rsc_id);a?e.widgets=e.widgets.map(e=>e.rsc_id===t.rsc_id?Object.assign(e,t):e):e.widgets.push(t)},addToBoard(e,t){e.boards=e.boards.map(a=>{if(a.name===e.board){const e=a.widgets.concat(t);a.widgets=e}return a})},removeFromBoard(e,t){const a=e.boards.map(a=>(a.name===e.board&&(a.widgets=a.widgets.filter(e=>{const a="string"===typeof e?e:e.rsc_id;return a!==t})),a));e.boards=a,e.widgets=e.widgets.filter(e=>e.rsc_id!==t)},setWidgets(e,t){e.widgets=t},setBoards(e,t){e.boards=t},setActiveBoard(e,t){e.board=t}},w={widgetById:e=>t=>e.widgets.find(e=>e.rsc_id===t),widgets(e){return e.widgets},boards(){return g.boards},board(){return g.board},boardWithWidgets(){return g.boards.find(e=>e.name===g.board)}};var y={namespaced:!0,state:g,actions:f,mutations:v,getters:w};r["default"].use(o["a"]);t["a"]=new o["a"].Store({modules:{widgets:y}})},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("a026"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("c4-webapp",{attrs:{"full-width":!0}},[a("side-navigation",{attrs:{slot:"navigation-slot"},slot:"navigation-slot"})],1)},s=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"boards-container",attrs:{fluid:""}},[a("v-row",{attrs:{column:"","no-gutters":""}},[a("v-col",{staticClass:" px-3",attrs:{cols:"12"}},[a("v-divider")],1),a("v-col",{staticClass:"mt-4",attrs:{cols:"12"}},[a("v-list",[a("v-subheader",{directives:[{name:"ripple",rawName:"v-ripple"}],on:{click:function(t){e.boardsVisible=!e.boardsVisible}}},[e._v(" MY BOARDS "),e.boardsVisible?e._e():a("span",{staticClass:"ml-2"},[e._v("("+e._s(e.boards.length)+")")]),a("v-spacer"),e.boardsVisible?a("v-icon",{attrs:{small:""}},[e._v("mdi-menu-up")]):a("v-icon",{attrs:{small:""}},[e._v("mdi-menu-down")])],1),a("div",{staticClass:"boards-group"},[e.boardsVisible?a("v-list-item-group",{staticClass:"sub-boards-group",attrs:{color:"primary"}},[null!=e.boards?[e._l(e.boards,(function(t){return[a("v-list-item",{key:t.name,staticClass:"pr-0",attrs:{"mouse-over":t.over=!0,"mouse-out":t.over=!1},on:{click:function(a){return e.setActiveBoard(t.name)}}},[a("v-list-item-icon",[a("v-icon",[e._v("mdi-view-dashboard-variant")])],1),a("v-list-item-content",[a("v-list-item-title",[e._v(" "+e._s(t.name)+" ")])],1),a("v-list-item-action",[a("v-icon",{attrs:{ripple:"",small:"",color:"grey"},on:{click:function(a){return e.onEditBoard(t.name)}}},[e._v("mdi-pencil")])],1)],1)]}))]:e._l(2,(function(t){return a("v-boilerplate",{key:t,staticClass:"pt-3",attrs:{loading:null==e.boards,type:"list-item-avatar"}})}))],2):e._e()],1),a("v-list-item-group",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("v-list-item",{on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.dialogOpen=!0}}},[a("v-list-item-icon",[a("v-icon",[e._v("mdi-plus-circle")])],1),a("v-list-item-content",[a("v-list-item-title",[e._v(" Add board ")])],1)],1)],1)],1)],1)],1),a("v-dialog",{attrs:{width:"500"},model:{value:e.dialogOpen,callback:function(t){e.dialogOpen=t},expression:"dialogOpen"}},[a("v-card",[a("v-card-title",[a("v-row",{attrs:{"no-gutters":""}},[a("h2",{staticClass:"text-h4"},[e._v(e._s(e.oldName?"Change name":"Add board"))]),a("v-spacer"),a("v-btn",{attrs:{icon:""},on:{click:function(t){e.dialogOpen=!1}}},[a("v-icon",[e._v("mdi-close")])],1)],1)],1),a("ValidationObserver",{ref:"observer",scopedSlots:e._u([{key:"default",fn:function(t){var r=t.handleSubmit;return[a("ValidationProvider",{attrs:{name:"Boardname",rules:{required:!0,max:30,boardexists:e.error}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.errors;return[a("v-form",{on:{submit:function(t){return t.preventDefault(),r(e.submit)}}},[a("v-card-text",{staticClass:"pt-5 pb-0"},[a("v-text-field",{attrs:{autofocus:"",clearable:"",outlined:"",filled:"","error-messages":o,label:"Boardname",required:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),a("v-card-actions",{staticClass:"pt-4 pb-8 px-7"},[a("v-btn",{attrs:{color:"primary",text:"",disabled:e.boards.length<=1},on:{click:e.deleteBoard}},[e._v(" Delete board ")]),a("v-spacer"),a("v-btn",{attrs:{color:"primary",text:""},on:{click:function(t){e.dialogOpen=!1,e.oldName=null,e.name=null}}},[e._v(" Cancel ")]),a("v-btn",{attrs:{disabled:e.block,color:"primary",type:"submit"}},[e._v(" Save ")])],1)],1)]}}],null,!0)})]}}])})],1)],1)],1)},i=[],c=a("2f62"),d=a("7bb1"),l=a("2ef0"),u=a.n(l),p={mounted(){window.addEventListener("resize",u.a.debounce(this.update,250)),console.log("init app manger",new Date)},components:{ValidationProvider:d["b"],ValidationObserver:d["a"],VBoilerplate:{functional:!0,render(e,{data:t,props:a,children:r}){return e("v-skeleton-loader",{...t,props:{boilerplate:!0,elevation:0,...a}},r)}}},computed:{...Object(c["c"])("widgets",["boards","board"])},data(){return{selected:null,dialogOpen:!1,block:!1,boardsVisible:!0,name:null,oldName:null,error:null}},watch:{dialogOpen(e,t){!1===e&&(this.selected=[],this.clear())},name(e,t){null!=this.error&&e!==t&&(this.error=null,this.block=!1,requestAnimationFrame(()=>{this.$refs.observer.reset()}))}},methods:{...Object(c["b"])("widgets",{setActiveBoard:"setActiveBoard",delBoard:"deleteBoard"}),async update(){await this.$nextTick();const e=document.querySelector(".c4-navigation-logo-container"),t=e.offsetHeight,a=document.querySelector(".c4-navigation-footer"),r=a.offsetHeight,o=document.querySelector(".c4-navigation"),s=o.offsetHeight,n=s-r-t;this.$el.style.height=n+"px";const i=n-56-100,c=this.$el.querySelector(".sub-boards-group").offsetHeight;console.log(i,c);const d=this.$el.querySelector(".boards-group");c>=i?(d.style.height=i+"px",d.classList.add("shadow")):(d.style.height="auto",d.classList.remove("shadow"))},deleteBoard(e){this.delBoard(this.name),this.dialogOpen=!1,this.oldName=null,this.name=null},onEditBoard(e){this.oldName=e,this.name=e,this.dialogOpen=!0},async clear(){this.oldName=null,this.block=!1,this.name=null,this.dialogOpen=!1,requestAnimationFrame(()=>{this.$refs.observer.reset()}),this.error=null},async submit(){await this.$nextTick(),this.$refs.observer.validate().then(async e=>{if(console.log(e),e){this.block=!0;try{const e=null!=this.oldName?"widgets/editBoard":"widgets/createBoard",t={board:this.name,oldName:this.oldName};await this.$store.dispatch(e,t);const a=null!=this.oldName?`Board „${this.name}“ changed.`:`Board „${this.name}“ created.`;this.$bus.$emit("SHOW_NOTIFICATION",{type:"success",text:a}),this.clear()}catch(t){console.log(t,"error caught"),"Board exists"===t.message&&(this.error=t.message+".")}}})}}},m=p,h=(a("5c7f"),a("2877")),b=Object(h["a"])(m,n,i,!1,null,"33c98e57",null),g=b.exports,f={components:{SideNavigation:g},mounted(){}},v=f,w=Object(h["a"])(v,o,s,!1,null,null,null),y=w.exports,_=a("a18c"),B=a("4360"),O=a("1528"),x=a("4c93");Object(d["c"])("required",{...x["c"],message:"This field is required"}),Object(d["c"])("max",{...x["b"],message:"This field must be {length} characters or less"}),Object(d["c"])("email",{...x["a"],message:"This field must be a valid email"}),Object(d["c"])("boardexists",{validate:(e,{customErrors:t})=>null==t||!t.includes("exists"),params:["customErrors"],message(e,t){return t.customErrors}}),Object(d["d"])("eager");var k=a("e166"),j=a.n(k),A=a("6c39"),E=a.n(A);r["default"].use(j.a,{props:{spinner:"bubbles"},system:{throttleLimit:25},slots:{noMore:"No more search results …",noResults:"No results …"}}),r["default"].use(E.a),r["default"].use(O["a"],{App:y,router:_["a"],store:B["a"],config:{TITLE:"Core4os"}})},"5c7f":function(e,t,a){"use strict";a("8eac")},"8eac":function(e,t,a){},a18c:function(e,t,a){"use strict";var r=a("a026"),o=a("8c4f"),s=a("4360");r["default"].use(o["a"]);const n=[{name:"enter",path:"/enter/:widgetId/:endpoint/:payload?",component:()=>a.e("help").then(a.bind(null,"c3ef"))},{name:"help",path:"/help/:widgetId/:endpoint",component:()=>a.e("help").then(a.bind(null,"c3ef"))},{path:"/:board?",name:"Home",component:()=>a.e("home").then(a.bind(null,"bb51"))}],i=new o["a"]({routes:n}),c=["content","help","notfound","enter"];i.beforeEach((e,t,a)=>{c.includes(e.name)&&s["a"].dispatch("widgets/fetchBoards",{type:"light"}),a()}),t["a"]=i},c151:function(e,t,a){"use strict";var r=a("dddc");const o="/setting/core_widgets_next",s={__createUser(){const e={name:"targobank_user",realname:"targobank user",passwd:"hans",email:"test@mail.de",role:["standard_user"],perm:["app://store/targobank"]};return r["a"].post("/roles",e).then(e=>!0)},__createStore(){const e={dark:{primary:"#FF0266",accent:"#03DAC5",secondary:"#424242",success:"#4CAF50",info:"#2196F3",warning:"#FB8C00",error:"#FF5252"},light:{primary:"#6200ee",accent:"#03DAC5",secondary:"#424242",success:"#4CAF50",info:"#2196F3",warning:"#FB8C00",error:"#FF5252"}};return r["a"].post("/store/targobank",{json:e}).then(e=>!0)},__getStore(){return r["a"].put("/store/targobank").then(e=>e.data)},createBoard(e){return this._putBoards({boards:e})},updateBoard(e){return this._putBoards(e)},_putBoards(e){return r["a"].put(o,{data:e}).then(e=>!0)},async fetchTags(e){try{const e=await r["a"].get("/_info?tag");return e.data}catch(t){console.warn(t)}},async fetchBoards(e){try{const e=await r["a"].get(o);return e.data||{boards:[],board:""}}catch(t){console.warn(t)}},async searchWidgets(e={search:"",tags:[],per_page:2,page:0}){const t={per_page:e.per_page,page:e.page},a=e.search;(a||"").length&&(t.search=a),e.tags.length&&(null!=e.tags.find(e=>!e.default)&&(t.api=!0),t.tag=JSON.stringify(e.tags.map(e=>e.value)));try{const e=await r["a"].get("/_info",{params:t});return e}catch(o){console.warn(o)}},async persistOptions(e={boards:[],board:null,sidebar:1}){return r["a"].post(o,{data:e}).then(e=>e).catch(e=>Promise.reject(e))}};r["a"].interceptors.response.use(e=>e,async e=>{if(!e.config.url.includes("/setting")||"get"!==e.config.method||400!==e.response.status)return Promise.reject(e);{const e=[{name:"First board",widgets:[]}],t={boards:e,board:e[0].name,sidebar:1,technical:!1};await s.persistOptions(t),window.location.reload()}}),t["a"]=s}});
//# sourceMappingURL=app.js.map